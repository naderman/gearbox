<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GearBox Project</title>

<link rel="icon" href="gbx_icon_cardbox_sky.png" type="image/png">
<link rel="shortcut icon" href="gbx_icon_cardbox_sky.png" type="image/png">

<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<!-- Google Analytics -->
<!--<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-184444-1";
urchinTracker();
</script>-->
<!-- Returning you to your regular programming -->
</head><body>

<!-- Header -->

<table border="0" cellspacing="0" cellpadding="0">

<tr><!-- create row -->

<!-- spacer cell -->
<!-- #CC CC CC -->
<td rowspan="1" colspan="1" bgcolor="#EEEEEE">&nbsp;&nbsp;&nbsp;&nbsp;</td>

<!-- menu cell -->
<td width="170" rowspan="1" colspan="1" align="left" valign="top" bgcolor="#EEEEEE">


<p>&nbsp;</p>
<p align="center"><a href="index.html"><img src="gbx_logo_cardbox_sky_150x150.png"></a></p><br>

<strong>INTRODUCTION</strong><br>
<strong><a href="gbx_doc_overview.html" style="text-decoration:none">Overview</a></strong><br>
<strong><a href="gbx_doc_getting.html" style="text-decoration:none">Download and Install</a></strong><br>
<!-- <strong><a href="gbx_doc_quickstart.html" style="text-decoration:none">Quick Start</a></strong><br> -->
<strong><a href="gbx_doc_documentation.html" style="text-decoration:none">Documentation</a></strong><br>
<!-- <strong><a href="gbx_doc_publications.html" style="text-decoration:none">Publications</a></strong><br> -->
<br>

<strong>REPOSITORY</strong><br>
<strong><a href="group__gbx__libs.html" style="text-decoration:none">Libraries</a></strong><br>
<!-- <strong><a href="group__gbx__utils.html" style="text-decoration:none">Utilities</a></strong><br> -->
<br>

<strong>DEVELOPER</strong><br>

<!--<strong><a href="gbx_doc_tutorials.html" style="text-decoration:none">Tutorials</a></strong><br>
<strong><a href="group__gbx__examples.html" style="text-decoration:none">Examples</a></strong><br>-->
<strong><a href="gbx_doc_devguide.html" style="text-decoration:none">Dev Guide</a></strong><br>
<!-- 
<strong><a href="gbx_doc_faq.html" style="text-decoration:none">FAQ</a></strong><br>
-->
<strong><a href="http://129.78.210.237:8081/gearbox/Dashboard/" style="text-decoration:none">Dashboard</a></strong><br>
<!--<strong><a href="http://wiki2.cas.edu.au/orca">Wiki</a></strong><br>
login/pass: orca/orca<br>-->
<br>

<strong>PEOPLE</strong><br>
<strong><a href="gbx_doc_contributors.html" style="text-decoration:none">Contributors</a></strong><br>
<strong><a href="gbx_doc_users.html" style="text-decoration:none">Users</a></strong><br>
<br>

<a href="http://sourceforge.net"><img src="http://sourceforge.net/sflogo.php?group_id=111647&amp;type=2" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a><br>
<strong><a href="http://sourceforge.net/projects/gearbox">Project</a></strong><br>
<strong><a href="http://sourceforge.net/project/showfiles.php?group_id=111647">Download</a></strong><br>
<!--<strong><a href="http://sourceforge.net/tracker/?group_id=111647">Bugs/Feedback</a></strong><br>-->
<strong><a href="http://sourceforge.net/mail/?group_id=111647">Mailing lists</a></strong></p>
<p>&nbsp;</p>

</td><!-- /menu cell -->

<!-- one grey spacer cells -->
<td rowspan="1" colspan="1" bgcolor="#EEEEEE">&nbsp;&nbsp;&nbsp;&nbsp;</td>

<!-- one white spacer cells -->
<td rowspan="1" colspan="1">&nbsp;&nbsp;&nbsp;&nbsp;</td>

<!-- main content cell -->
<td rowspan="1" colspan="1" align="left" valign="top">


<!-- Generated by Doxygen 1.5.4 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<h1><a class="anchor" name="gbx_doc_buildsys">Tutorial for the GearBox Build System </a></h1>The term <a href="http://en.wikipedia.org/wiki/Build_system">build system</a> refers the software and procedures responsible for compiling, installing, and distributing source code. GearBox uses <a href="http://www.cmake.org">CMake</a> to handle its build system. CMake is a cross-platform tool, designed as a replacement for autotools.<p>
Contents:<ul>
<li><a class="el" href="gbx_doc_buildsys.html#gbx_doc_buildsys_basics">Basics</a></li><li><a class="el" href="gbx_doc_buildsys.html#gbx_doc_buildsys_example">Example</a></li><li><a class="el" href="gbx_doc_buildsys.html#gbx_doc_buildsys_lines">Line-by-Line</a></li><li><a class="el" href="gbx_doc_buildsys.html#gbx_doc_buildsys_varlist">A list of useful CMake variables defined by GearBox</a></li></ul>
<h2><a class="anchor" name="gbx_doc_buildsys_basics">
Basics</a></h2>
Builds are controlled by a set of files called 'CMakeLists.txt'. There is approximately one in each directory, and builds descend recursively through the source tree.<p>
An individual developer only needs to be concerned with writing CMakeLists.txt files in the directory containing his or her library code and below.<h2><a class="anchor" name="gbx_doc_buildsys_example">
Example</a></h2>
Here's an example of a CMakeLists.txt file to builid a library. We'll go through it line by line.<p>
<div class="fragment"><pre class="fragment">
SET ( lib_name GbxAdvanced )
GBX_ADD_LICENSE( GPL )

SET ( build TRUE )

# Check for human input
GBX_REQUIRE_OPTION( build LIB ${lib_name} ON )

# Check arbitrary variables
GBX_REQUIRE_VAR( build LIB ${lib_name} GBX_OS_LINUX "only Linux OS is supported" )

# Check local targets (libraries or executables)
SET( dep_libs basic )
GBX_REQUIRE_TARGETS( build LIB ${lib_name} ${dep_libs} )

IF ( build )
    
    INCLUDE( ${GBX_CMAKE_DIR}/UseBasicRules.cmake )

    FILE( GLOB hdrs *.h )
    FILE( GLOB srcs *.cpp )

    GBX_ADD_LIBRARY( ${lib_name} SHARED ${srcs} )
    TARGET_LINK_LIBRARIES( ${lib_name} ${dep_libs} )

    GBX_ADD_HEADERS( gbxadvanced ${hdrs} )

ENDIF ( build )
</pre></div><h2><a class="anchor" name="gbx_doc_buildsys_lines">
Line-by-Line</a></h2>
<div class="fragment"><pre class="fragment">
SET ( lib_name GbxAdvanced )
</pre></div> All variables in CMake contain text. Assignment is done with SET function. (The C++ equivalent of this line: <code>string lib_name = "GbxAdvanced"</code>).<ul>
<li>You can get more information on this and all other CMake commands. <div class="fragment"><pre class="fragment">
$ cmake --help-command SET
</pre></div></li></ul>
<p>
Notice the GearBox convention for naming CMake variables:<ul>
<li>All "local" variables created in this CMakeLists.txt are in low case, e.g. <code>lib_name</code>.</li><li>All "global" variables created somewhere else are in upper case.</li><li>All custom "global" variables created by GearBox start with "GBX_", e.g. <code>GBX_CMAKE_DIR</code>.</li><li>Note that the standard CMake variables are also in upper case and some start with "CMAKE_", e.g. <code>CMAKE_INSTALL_PREFIX</code> and some don't, e.g. <code>PROJECT_NAME</code>.</li></ul>
<p>
<div class="fragment"><pre class="fragment">
GBX_ADD_LICENSE( GPL )
</pre></div> This macro adds license information about this library to the global list which will be dumped into the <code>LICENSE</code> file at the top level of the distribution (check out what it looks like). This is a custom GearBox macro as indicated by the "GBX_" prefix. Any text can be put into this macro, e.g. "LGPL (with written permission from the original authors)".<p>
<div class="fragment"><pre class="fragment">
SET ( build TRUE )
</pre></div> This and the following few lines determine whether we are going to build this library or not. We start with the assumption that we will and then check a few requirements sequentially. We define a variable called <code>build</code> and set it to TRUE, i.e. "this library will be built". Failure to meet any one of the requirements will assign FALSE to this "cumulative variable".<p>
<div class="fragment"><pre class="fragment">
# Check for human input
GBX_REQUIRE_OPTION( build LIB ${lib_name} ON )
</pre></div> Any text following "#" is a comment. Use them to explain uncommon usage.<p>
This GearBox macro checks for user input into the build process. It is actually a shortcut which does several things:<ul>
<li>Defines a CMake cache variable called <code>BUILD_LIB_GBXADVANCED</code> which can be used a user-controlled switch for turning compilation of this library ON and OFF. You will see this option when you run the <code>ccmake</code> tool. The option variable is defined the very first time CMake is run, and it is assigned the specified default value (ON).</li><li>Every time CMake runs, it checks the current value of the <code>BUILD_LIB_GBXADVANCED</code> variable. If the user configured it FALSE, then the value of <code>build</code> variable will also become FALSE.</li><li>If it is decided that the library will not be built due to user input a corresponding entry will be added to a global list and the name of the library will be printed out at the end of the CMake process under the "Will NOT build..." heading.</li></ul>
<p>
Notice that to evaluate the variable you have to inclose it in braces and add a dollar sign, i.e. <code>${lib_name}</code>. Without this, CMake would just treat it as text. (Similar to the UNIX shells).<p>
This macro is quite flexible. You can specify custom names for the option variables and provide a custom description.<ul>
<li>Here's the complete signature. <div class="fragment"><pre class="fragment">
GBX_REQUIRE_OPTION( cumulative_var [EXE | LIB] module_name default_option_value [option_name] [option_description] )
</pre></div> The last two parameters are optional and have sensible defaults. Nothing else in the build depends on these variables so it's safe to specify them.</li></ul>
<p>
<div class="fragment"><pre class="fragment">
GBX_REQUIRE_VAR( build LIB ${lib_name} GBX_OS_LINUX "only Linux OS is supported" )
</pre></div> Next comes another "REQUIRE_" macro. This one checks that an arbitrary variable, in this case <code>GBX_OS_LINUX</code>, evaluates to TRUE. Examples of usage are: check that the OS is supported, the compiler version is acceptable, that dependencies are found, versions of required libraries are new enough, etc.<p>
<ul>
<li>This is the most common macro. Typically, several of these macros check variables one after another. The complete signature: <div class="fragment"><pre class="fragment">
GBX_REQUIRE_VAR ( cumulative_var [EXE | LIB] module_name test_var reason )
</pre></div></li><li>If you want to require that a variable evaluates to FALSE, just invert it and evaluate: <div class="fragment"><pre class="fragment">
SET( not_os_win NOT GBX_OS_WIN )
GBX_REQUIRE_VAR( build LIB ${lib_name} not_os_win "anything but Windows is supported" )
</pre></div></li></ul>
<p>
<div class="fragment"><pre class="fragment">
SET( dep_libs basic )
GBX_REQUIRE_TARGETS( build LIB ${lib_name} ${dep_libs} )
</pre></div> The last of the "REQUIRE_" macros: very useful if you link to other libraries in GearBox. Important: this one is for working with <em>internal</em> libraries only. You have to make sure that the required libraries are going to be built because they may be disabled for the same reasons as this one, i.e. user configuration, unsupported OS, lack of prerequisites. Notice that <code>dep_libs</code> can contain a list of libraries separated by a space. In this case we only have one called "basic". In order to reduce the amount of typing required we will reuse this variable later when it comes to actually linking.<p>
<ul>
<li>The complete signature of this macro and a related "singular" version: <div class="fragment"><pre class="fragment">
GBX_REQUIRE_TARGETS( cumulative_var [EXE | LIB] module_name TARGET0 [TARGET1 TARGET2 ...] )
GBX_REQUIRE_TARGET( cumulative_var [EXE | LIB] module_name TARGET [reason] )
</pre></div></li></ul>
<p>
<div class="fragment"><pre class="fragment">
IF ( build )
</pre></div> Ok, we've checked everything. Now <code>build</code> variable can tell us to build or not to build.<p>
A note on slightly funky CMake syntax: notice that in the IF statement and in other places with a boolean context, CMake accepts both the variable name, i.e. <code>build</code>, and it's evaluation, i.e. <code>${build}</code>. We find that more consistent results are obtained with the variable names.<p>
<div class="fragment"><pre class="fragment">
    INCLUDE( ${GBX_CMAKE_DIR}/UseBasicRules.cmake )
</pre></div> Commonly used CMake scripts are stored in a one directory <code></code>[GEARBOX-SRC]/cmake. For convenience, this path is stored in the special variable <code>GBX_CMAKE_DIR</code>. The <code>INCLUDE</code> command literally pastes the contents of the referenced scripts right here in the middle of our file. So you can take a look at that script to see what it does. Importantly, it adds <code>-Wall</code> compiler definition.<p>
<div class="fragment"><pre class="fragment">
    FILE( GLOB hdrs *.h )
    FILE( GLOB srcs *.cpp )
</pre></div> Search for file in the current directory which fit the specified pattern and assign the list to the variables <code>hdrs</code> and <code>srcs</code>.<ul>
<li>Instead of searching you can just list the files you need. <div class="fragment"><pre class="fragment">
SET( srcs util.cpp )
</pre></div></li></ul>
<p>
<div class="fragment"><pre class="fragment">
    GBX_ADD_LIBRARY( ${lib_name} SHARED ${srcs} )
    TARGET_LINK_LIBRARIES( ${lib_name} ${dep_libs} )
</pre></div> Here we tell CMake to create rules for building a shared library and to specify dependencies. Now you can see why we bothered with defining variables. These commands are generic and can be easily used for other libraries.<p>
<code>GBX_ADD_LIBRARY</code> is a custom GearBox macro. It does several things:<ul>
<li>Actually defines a library target (with a standard command <code>ADD_LIBRARY</code> ). In Linux, this will produce <code>libGbxAdvanced.so</code> </li><li>Specifies standard installation directory: <code></code>[PREFIX]/lib/gearbox/</li><li>Adds the name of the library to the global list of libraries which will be built (for feedback).</li></ul>
<p>
<code>TARGET_LINK_LIBRARIES</code> is a standard CMake command. It specifies that our library is to be linked to our dependencies.<p>
<div class="fragment"><pre class="fragment">
    GBX_ADD_HEADERS( gbxadvanced ${hdrs} )
</pre></div> This custom macro doesn't save much space but prevents easily-made mistakes. It specifies destination for header files to be <code></code>[PREFIX]/include/gearbox/gbxadvanced. With the custom macro only the module subdirectory needs to be specified.<p>
<div class="fragment"><pre class="fragment">
ENDIF ( build )
</pre></div> Don't forget to close the IF structure. Notice that CMake is quite strict with <code>IF</code> statements: the signature of the closing <code>ENDIF</code> must be identical.<h2><a class="anchor" name="gbx_doc_buildsys_varlist">
A list of useful CMake variables defined by GearBox</a></h2>
OS variables: evaluate to TRUE when running on the corresponding OS, otherwise to FALSE. We define our own because the standard CMake ones are inconsistently named and the one for Linux is not defined. <div class="fragment"><pre class="fragment">
GBX_OS_LINUX
GBX_OS_MAC
GBX_OS_QNX
GBX_OS_WIN
</pre></div><p>
Path variables: <div class="fragment"><pre class="fragment">
GBX_PROJECT_BINARY_DIR
GBX_PROJECT_SOURCE_DIR
</pre></div> 
            </td>
            <td colspan="1">&nbsp;</td>
         </tr>
        </table>
<!-- end of table -->

 <hr size="1"><address style="align: right;"><small>Generated for GearBox by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
